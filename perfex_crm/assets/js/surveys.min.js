function survey_toggle_full_view(){$("#survey-add-edit-wrapper").toggleClass("hide"),$("#survey_questions_wrapper").toggleClass("col-md-12"),$("#survey_questions_wrapper").toggleClass("col-md-7")}function add_survey_question(e,t){$.post(admin_url+"surveys/add_survey_question",{type:e,surveyid:t}).done(function(t){t=JSON.parse(t),question_area="<li>",question_area+='<div class="form-group question">',question_area+='<div class="checkbox checkbox-primary required">',question_area+='<input type="checkbox" data-question_required="'+t.data.questionid+'" name="required[]" onchange="update_question(this,\''+e+"',"+t.data.questionid+')">',question_area+="<label>"+t.survey_question_required+"</label>",question_area+="</div>",question_area+=hidden_input("order[]",""),question_area+='<label for="'+t.data.questionid+'" class="control-label display-block">'+t.survey_question_string+' <a href="#" onclick="update_question(this,\''+e+"',"+t.data.questionid+'); return false;" class="pull-right update-question-button"><i class="fa fa-refresh text-success question_update"></i></a><a href="#" class="pull-right"><i class="fa fa-remove text-danger" onclick="remove_question_from_database(this,'+t.data.questionid+'); return false;"></i></a></label>',question_area+='<input type="text" onblur="update_question(this,\''+e+"',"+t.data.questionid+');" data-questionid="'+t.data.questionid+'" class="form-control questionid">',"textarea"==e?question_area+='<textarea class="form-control mtop20" disabled="disabled" rows="6">'+t.survey_question_only_for_preview+"</textarea>":"checkbox"==e||"radio"==e?(question_area+='<div class="row">',box_description_icon_class="fa-plus",box_description_function="add_box_description_to_database(this,"+t.data.questionid+","+t.data.boxid+"); return false;",question_area+='<div class="box_area">',question_area+='<div class="col-md-12">',question_area+='<a href="#" class="add_remove_action survey_add_more_box" onclick="'+box_description_function+'"><i class="fa '+box_description_icon_class+'"></i></a>',question_area+='<div class="'+e+" "+e+'-primary">',question_area+='<input type="'+e+'" disabled="disabled"/>',question_area+="<label><input onblur=\"update_question(this,'"+e+"',"+t.data.questionid+');" type="text" data-box-descriptionid="'+t.data[0].questionboxdescriptionid+'" class="survey_input_box_description"></label>',question_area+="</div>",question_area+="</div>",question_area+="</div>",question_area+="</div>"):question_area+='<input type="text" onchange="update_question(this,\''+e+"',"+t.data.questionid+');" class="form-control mtop20" disabled="disabled" value="'+t.survey_question_only_for_preview+'">',question_area+="</div>",question_area+="</li>",$("#survey_questions").append(question_area),$("#survey_questions").sortable("refresh"),$("html,body").animate({scrollTop:$("#survey_questions li:last-child").offset().top},"slow"),update_questions_order()})}function update_question(e,t,s){$(e).parents("li").find("i.question_update").addClass("spinning");var i={},a=$(e).parents(".question").find('input[data-questionid="'+s+'"]').val(),o=$(e).parents(".question").find('input[data-question_required="'+s+'"]').prop("checked");if(i.question={value:a,required:o},i.questionid=s,"checkbox"==t||"radio"==t){var n=[],r=$(e).parents(".question").find(".box_area");$.each(r,function(){var e=[$(this).find("input.survey_input_box_description").data("box-descriptionid"),$(this).find("input.survey_input_box_description").val()];n.push(e)}),i.boxes_description=n}setTimeout(function(){$.post(admin_url+"surveys/update_question",i).done(function(t){$(e).parents("li").find("i.question_update").removeClass("spinning")})},10)}function add_more_boxes(e,t){var s=$(e).parents(".box_area").clone();$(e).parents(".question").find(".box_area").last().after(s),$(s).find("i").removeClass("fa-plus").addClass("fa-minus").addClass("text-danger"),$(s).find("input.survey_input_box_description").val(""),$(s).find("input.survey_input_box_description").attr("data-box-descriptionid",t),$(s).find("input.survey_input_box_description").focus(),$(s).find(".add_remove_action").attr("onclick","remove_box_description_from_database(this,"+t+"); return false;"),update_questions_order()}function remove_question_from_database(e,t){$.get(admin_url+"surveys/remove_question/"+t,function(t){0==t.success?alert_float("danger",t.message):($(e).parents(".question").remove(),update_questions_order())},"json")}function remove_box_description_from_database(e,t){$.get(admin_url+"surveys/remove_box_description/"+t,function(t){1==t.success?$(e).parents(".box_area").remove():alert_float("danger",t.message)},"json")}function add_box_description_to_database(e,t,s){$.get(admin_url+"surveys/add_box_description/"+t+"/"+s,function(t){!1!==t.boxdescriptionid?add_more_boxes(e,t.boxdescriptionid):alert_float("danger",t.message)},"json")}function update_questions_order(){var e=$("#survey_questions").find(".question"),t=1;$.each(e,function(){$(this).find('input[name="order[]"]').val(t),t++});var s=[];$.each(e,function(){var e=$(this).find("input.questionid").data("questionid"),t=$(this).find('input[name="order[]"]').val();s.push([e,t])}),data={},data.data=s,$.post(admin_url+"surveys/update_survey_questions_orders",data)}$(function(){$('input[name="send_survey_to[leads]"]').on("change",function(){$(".leads-statuses").slideToggle()}),$('input[name="send_survey_to[clients]"]').on("change",function(){$(".customer-groups").slideToggle()}),$(".survey-customer-groups input").on("change",function(){$(".survey-customer-groups input:checked").length>0&&$("#ml_customers_all").prop("checked",!1)}),$("#ml_customers_all").on("change",function(){!1!==$(this).prop("checked")&&$(".survey-customer-groups input").prop("checked",!1)}),_validate_form($("#survey_form"),{subject:"required"});$("#survey_questions").sortable({placeholder:"ui-state-highlight-survey",update:function(){update_questions_order()}});$(".add_email_list_custom_field_to_survey").on("click",function(e){e.preventDefault(),tinymce.get("description").execCommand("mceInsertContent",!1,$(this).data("slug"))})});