function alert_float(e,t){var a,i;a=$("body").find("float-alert").length,a="alert_float_"+ ++a,i=$('<div id="'+a+'" class="float-alert animated fadeInRight col-xs-11 col-sm-4 alert alert-'+e+'"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><span>'+t+"</span></div>"),$("body").append(i),setTimeout(function(){$("#"+a).remove()},3e3)}function new_discussion(){$("#discussion").modal("show"),$("#discussion .edit-title").addClass("hide")}function manage_discussion(e){var t=$(e).serialize(),a=e.action;return $.post(a,t).done(function(e){1==(e=JSON.parse(e)).success&&alert_float("success",e.message),$(".table-project-discussions").DataTable().ajax.reload(null,!1),$("#discussion").modal("hide")}),!1}function remove_task_comment(e){$.get(site_url+"clients/remove_task_comment/"+e,function(e){1==e.success&&window.location.reload()},"json")}function edit_task_comment(e){$('[data-edit-comment="'+e+'"]').removeClass("hide"),$('[data-comment-content="'+e+'"]').addClass("hide")}function cancel_edit_comment(e){$('[data-edit-comment="'+e+'"]').addClass("hide"),$('[data-comment-content="'+e+'"]').removeClass("hide")}function save_edited_comment(e){var t={};t.id=e,t.content=$('[data-edit-comment="'+e+'"]').find("textarea").val(),$.post(site_url+"clients/edit_comment",t).done(function(t){1==(t=JSON.parse(t)).success?window.location.reload():cancel_edit_comment(e)})}function DataTablesOfflineLazyLoadImages(e,t,a){var i=$("img.img-table-loading",e);return i.attr("src",i.data("orig")),i.prev("div").addClass("hide"),e}function initDataTable(){var e=[10,25,50,100],t=[10,25,50,100];tables_pagination_limit=parseFloat(tables_pagination_limit),-1==$.inArray(tables_pagination_limit,e)&&(e.push(tables_pagination_limit),t.push(tables_pagination_limit)),e.sort(function(e,t){return e-t}),t.sort(function(e,t){return e-t}),e.push(-1),t.push(dt_length_menu_all);var a,i,s,n={language:dt_lang,paginate:!0,pageLength:tables_pagination_limit,lengthMenu:[e,t],fnRowCallback:DataTablesOfflineLazyLoadImages,order:[0,"DESC"],fnDrawCallback:function(e){0==e.aoData.length||0==e.aiDisplay.length?$(e.nTableWrapper).addClass("app_dt_empty"):$(e.nTableWrapper).removeClass("app_dt_empty")},initComplete:function(e,t){this.wrap('<div class="table-responsive"></div>')}},o=$(".dt-table");$.each(o,function(){a=n,i=$(this).attr("data-order-col"),s=$(this).attr("data-order-type"),i&&s&&(a.order=[[i,s]]),$(this).DataTable(a)})}function get_url_param(e){var t={};return window.location.href.replace(location.hash,"").replace(/[?&]+([^=&]+)=?([^&]*)?/gi,function(e,a,i){t[a]=void 0!==i?i:""}),e?t[e]?t[e]:null:t}function fix_phases_height(){if(!is_mobile()){var e=Math.max.apply(null,$("div.tasks-phases .panel-body").map(function(){return $(this).outerHeight()}).get());$("div.tasks-phases .panel-body").css("min-height",e+"px")}}function color(e,t,a){return"rgb("+e+","+t+","+a+")"}function taskTable(){$(".tasks-table").toggleClass("hide"),$(".tasks-phases").toggleClass("hide")}function dt_custom_view(e,t,a){$(e).DataTable().column(t).search(a).draw()}function discussion_comments(e,t,a){$(e).comments({roundProfilePictures:!0,textareaRows:4,textareaRowsOnFocus:6,enableDeleting:!0,profilePictureURL:discussion_user_profile_image_url,enableUpvoting:!1,enableAttachments:!0,popularText:"",enableDeletingCommentWithReplies:!0,textareaPlaceholderText:discussions_lang.discussion_add_comment,newestText:discussions_lang.discussion_newest,oldestText:discussions_lang.discussion_oldest,attachmentsText:discussions_lang.discussion_attachments,sendText:discussions_lang.discussion_send,replyText:discussions_lang.discussion_reply,editText:discussions_lang.discussion_edit,editedText:discussions_lang.discussion_edited,youText:discussions_lang.discussion_you,saveText:discussions_lang.discussion_save,deleteText:discussions_lang.discussion_delete,viewAllRepliesText:discussions_lang.discussion_view_all_replies+" (__replyCount__)",hideRepliesText:discussions_lang.discussion_hide_replies,noCommentsText:discussions_lang.discussion_no_comments,noAttachmentsText:discussions_lang.discussion_no_attachments,attachmentDropText:discussions_lang.discussion_attachments_drop,getComments:function(e,i){$.post(site_url+"clients/project/"+project_id,{action:"discussion_comments",discussion_id:t,discussion_type:a}).done(function(t){t=JSON.parse(t),e(t)})},postComment:function(e,i,s){e.action="new_discussion_comment",e.discussion_id=t,e.discussion_type=a,$.ajax({type:"post",url:site_url+"clients/project/"+project_id,data:e,success:function(e){e=JSON.parse(e),i(e)},error:s})},putComment:function(e,t,a){e.action="update_discussion_comment",$.ajax({type:"post",url:site_url+"clients/project/"+project_id,data:e,success:function(e){e=JSON.parse(e),t(e)},error:a})},deleteComment:function(e,t,a){$.ajax({type:"post",url:site_url+"clients/project/"+project_id,success:t,error:a,data:{id:e.id,action:"delete_discussion_comment"}})},timeFormatter:function(e){return moment(e).fromNow()},uploadAttachments:function(e,i,s){var n=0,o=[],l=function(){++n==e.length&&(0==o.length?s():(o=JSON.parse(o),i(o)))};$(e).each(function(e,i){if(i.file.size&&i.file.size>max_php_ini_upload_size_bytes)alert_float("danger",file_exceeds_max_filesize),l();else{var s=new FormData;$(Object.keys(i)).each(function(e,t){var a=i[t];a&&s.append(t,a)}),s.append("action","new_discussion_comment"),s.append("discussion_id",t),s.append("discussion_type",a),"undefined"!=typeof csrfData&&s.append(csrfData.token_name,csrfData.hash),$.ajax({url:site_url+"clients/project/"+project_id,type:"POST",data:s,cache:!1,contentType:!1,processData:!1,success:function(e){o.push(e),l()},error:function(e){alert_float("danger",JSON.parse(e.responseText).message),l()}})}})}})}function view_project_file(e,t){$.post(site_url+"clients/project/"+t,{action:"get_file",id:e,project_id:t}).done(function(e){$("#project_file_data").html(e)}).fail(function(e){alert_float("danger",e.statusText)})}function update_file_data(e){var t={};t.id=e,t.subject=$('body input[name="file_subject"]').val(),t.description=$('body textarea[name="file_description"]').val(),t.action="update_file_data",$.post(site_url+"clients/project/"+project_id,t)}function close_modal_manually(e){$(e).fadeOut("slow",function(){$(e).remove(),$(".modal-backdrop").remove(),$("body").removeClass("modal-open")})}function render_customer_statement(){var e=$("#range").selectpicker("val"),t=new Array,a=!1;if("period"!=e)t=JSON.parse(e);else{if(t[0]=$('input[name="period-from"]').val(),t[1]=$('input[name="period-to"]').val(),""==t[0]||""==t[1])return!1;a=!0}var i=site_url+"clients/statement",s=new Array;s.from=t[0],s.to=t[1],a&&(s.custom_period=!0),window.location.href=buildUrl(i,s)}function client_home_chart(){var e=$("#client-home-chart");if(0!=e.length){void 0!==salesChart&&salesChart.destroy();var t={},a=$("#currency"),i=$("#payments_year");a.length>0&&(t.report_currency=$('select[name="currency"]').val()),i.length>0&&(t.year=$("#payments_year").val()),$.post(site_url+"clients/client_home_chart",t).done(function(t){t=JSON.parse(t),salesChart=new Chart(e,{type:"bar",data:t,options:{responsive:!0,maintainAspectRatio:!1}})})}}var project_id=$('input[name="project_id"]').val(),discussion_user_profile_image_url=$('input[name="discussion_user_profile_image_url"]').val(),discussion_id=$('input[name="discussion_id"]').val();Dropzone.options.projectFilesUpload=!1,Dropzone.options.taskFileUpload=!1,Dropzone.options.filesUpload=!1;var salesChart;$(function(){fix_phases_height(),initDataTable(),moment.locale(locale),moment().tz(timezone).format();var e=get_url_param("file_id");if(e&&view_project_file(e,project_id),$("a[href='#top']").on("click",function(e){e.preventDefault(),$("html,body").animate({scrollTop:0},1e3),e.preventDefault()}),$("a[href='#bot']").on("click",function(e){e.preventDefault(),$("html,body").animate({scrollTop:$(document).height()},1e3),e.preventDefault()}),client_home_chart(),$('select[name="currency"],select[name="payments_years"]').on("change",function(){client_home_chart()}),discussion_comments("#discussion-comments",discussion_id,"regular"),$("body").on("show.bs.modal","._project_file",function(){discussion_comments("#project-file-discussion",discussion_id,"file")}),"undefined"!=typeof Dropbox&&($("#dropbox-chooser-task").length>0&&document.getElementById("dropbox-chooser-task").appendChild(Dropbox.createChooseButton({success:function(e){$.post(site_url+"clients/project/"+project_id,{files:e,task_id:$('input[name="task_id"]').val(),external:"dropbox",action:"add_task_external_file"}).done(function(){window.location.reload()})},linkType:"preview",extensions:allowed_files.split(",")})),$("#files-upload").length>0&&document.getElementById("dropbox-chooser-files").appendChild(Dropbox.createChooseButton({success:function(e){$.post(site_url+"clients/upload_files",{files:e,external:"dropbox"}).done(function(){window.location.reload()})},linkType:"preview",extensions:allowed_files.split(",")})),"undefined"!=typeof Dropbox&&$("#dropbox-chooser-project-files").length>0&&document.getElementById("dropbox-chooser-project-files").appendChild(Dropbox.createChooseButton({success:function(e){$.post(site_url+"clients/project/"+project_id,{files:e,external:"dropbox",action:"project_file_dropbox"}).done(function(){var e=window.location.href;window.location.href=e.split("?")[0]+"?group=project_files"})},linkType:"preview",extensions:allowed_files.split(",")}))),$("#files-upload").length>0&&new Dropzone("#files-upload",{paramName:"file",dictFileTooBig:file_exceeds_maxfile_size_in_form,dictDefaultMessage:drop_files_here_to_upload,dictFallbackMessage:browser_not_support_drag_and_drop,maxFilesize:(max_php_ini_upload_size_bytes/1048576).toFixed(0),accept:function(e,t){t()},success:function(e,t){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&window.location.reload()},acceptedFiles:allowed_files,error:function(e,t){alert_float("danger",t)}}),$("#calendar").length){var t={themeSystem:"bootstrap3",header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},editable:!1,eventLimit:parseInt(calendar_events_limit)+1,views:{day:{eventLimit:!1}},defaultView:default_view_calendar,eventLimitClick:function(e,t){$("#calendar").fullCalendar("gotoDate",e.date),$("#calendar").fullCalendar("changeView","basicDay")},loading:function(e,t){e&&$("#calendar .fc-header-toolbar .btn-default").addClass("btn-info").removeClass("btn-default").css("display","block"),e?$(".dt-loader").removeClass("hide"):$(".dt-loader").addClass("hide")},isRTL:"true"==isRTL,eventStartEditable:!1,firstDay:parseInt(calendar_first_day),eventSources:[{url:site_url+"clients/get_calendar_data",type:"GET",error:function(){console.error("There was error fetching calendar data")}}],eventRender:function(e,t){t.attr("title",e._tooltip),t.attr("onclick",e.onclick),t.attr("data-toggle","tooltip")}};$("#calendar").fullCalendar(t)}var a=get_url_param("group");a&&($("body").find(".nav-tabs li").removeClass("active"),$("body").find('.nav-tabs [data-group="'+a+'"]').parents("li").addClass("active"));for(var i=-10;i<$(".task-phase").not(".color-not-auto-adjusted").length/2;i++){$(".task-phase:eq("+(i+10)+")").not(".color-not-auto-adjusted").css("background",color(120-13*i,169-13*i,56-13*i)).css("border","1px solid "+color(120-13*i,169-13*i,56-13*i))}$(".project-progress").circleProgress({fill:{gradient:["#84c529","#84c529"]}}).on("circle-animation-progress",function(e,t,a){$(this).find("strong.project-percent").html(parseInt(100*a)+"<i>%</i>")});$(".toggle-change-ticket-status").on("click",function(){$(".ticket-status,.ticket-status-inline").toggleClass("hide")}),$("#ticket_status_single").on("change",function(){data={},data.status_id=$(this).val(),data.ticket_id=$('input[name="ticket_id"]').val(),$.post(site_url+"clients/change_ticket_status/",data).done(function(){window.location.reload()})}),"undefined"!=typeof contracts_by_type&&new Chart($("#contracts-by-type-chart"),{type:"bar",data:JSON.parse(contracts_by_type),options:{responsive:!0,maintainAspectRatio:!1,scales:{yAxes:[{display:!0,ticks:{beginAtZero:!0}}]}}}),$("#task-file-upload").length>0&&new Dropzone("#task-file-upload",{uploadMultiple:!0,parallelUploads:20,maxFiles:20,paramName:"file",dictFileTooBig:file_exceeds_maxfile_size_in_form,dictDefaultMessage:drop_files_here_to_upload,maxFilesize:(max_php_ini_upload_size_bytes/1048576).toFixed(0),dictFallbackMessage:browser_not_support_drag_and_drop,accept:function(e,t){t()},sending:function(e,t,a){a.append("action","upload_task_file"),a.append("task_id",$('input[name="task_id"]').val())},success:function(e,t){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&window.location.reload()},acceptedFiles:allowed_files,error:function(e,t){alert_float("danger",t)}}),$("#project-files-upload").length>0&&new Dropzone("#project-files-upload",{paramName:"file",uploadMultiple:!0,parallelUploads:20,maxFiles:20,dictFileTooBig:file_exceeds_maxfile_size_in_form,dictDefaultMessage:drop_files_here_to_upload,dictFallbackMessage:browser_not_support_drag_and_drop,maxFilesize:(max_php_ini_upload_size_bytes/1048576).toFixed(0),accept:function(e,t){t()},sending:function(e,t,a){a.append("action","upload_file")},success:function(e,t){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&window.location.reload()},acceptedFiles:allowed_files,error:function(e,t){alert_float("danger",t)}}),$("#open-new-ticket-form").validate(),$("#ticket-reply").validate(),$("#task-form").validate();var s=1;$(".add_more_attachments").on("click",function(){if($(this).hasClass("disabled"))return!1;var e=$('.attachments input[name*="attachments"]').length;if($(this).data("ticket")&&e>=maximum_allowed_ticket_attachments)return!1;var t=$(".attachments").find(".attachment").eq(0).clone().appendTo(".attachments");t.find("input").val("").attr("name","attachments["+s+"]"),t.find("input").removeAttr("aria-describedby"),t.find("input").removeAttr("aria-invalid"),t.find('span[id*="error"]').remove(),t.find("i").removeClass("fa-plus").addClass("fa-minus"),t.find("button").removeClass("add_more_attachments").addClass("remove_attachment").removeClass("btn-success").addClass("btn-danger"),s++}),$("body").on("click",".remove_attachment",function(){$(this).parents(".attachment").remove()}),$(".single-ticket-add-reply").on("click",function(e){e.preventDefault(),$(".single-ticket-reply-area").slideToggle()}),$('body.viewinvoice input[name="amount"]').on("keyup",function(){var e=$(this).data("total"),t=$(this).val(),a=$(this).parents(".form-group");t>e?(a.addClass("has-error"),0==a.find("p.text-danger").length&&(a.append('<p class="text-danger">Maximum pay value passed</p>'),$(this).parents("form").find('input[name="make_payment"]').attr("disabled",!0))):(a.removeClass("has-error"),a.find("p.text-danger").remove(),$(this).parents("form").find('input[name="make_payment"]').attr("disabled",!1))}),$("#discussion_form").validate({rules:{subject:"required"}}),$("#discussion").on("hidden.bs.modal",function(e){$('#discussion input[name="subject"]').val(""),$('#discussion textarea[name="description"]').val(""),$("#discussion .add-title").removeClass("hide"),$("#discussion .edit-title").removeClass("hide")})});